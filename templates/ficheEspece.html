<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>{{taxon.lb_nom}}</title>

        <!-- Jquery -->
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/jquery-ui.css') }}" />
        <script type=text/javascript src="{{url_for('static', filename='/lib/jquery-1.12.4.min.js') }}"></script>
        // <script type=text/javascript src="{{url_for('static', filename='lib/jquery-ui.min.js') }}"></script>

        <!-- Bootrap -->
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/bootstrap/css/bootstrap.min.css') }}"></link>
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/bootstrap-switch/css/bootstrap-switch.min.css') }}"></link>

        <link rel="stylesheet" href="{{url_for('static', filename='/lib/node_modules/bootstrap-slider/dist/css/bootstrap-slider.min.css') }}" />
        <script src="{{url_for('static', filename='/lib/node_modules/bootstrap-slider/dist/bootstrap-slider.min.js') }}"></script>


        <script type=text/javascript src="{{url_for('static', filename='/lib/bootstrap-switch/js/bootstrap-switch.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/bootstrap-switch/css/bootstrap-switch.min.css') }}" />









        <!-- Leaflet -->
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/leaflet/leaflet.css') }}" />
        <link rel="stylesheet" href="{{url_for('static', filename='/css/ficheEspece.css') }}" />
        <script src="{{url_for('static', filename='/lib/leaflet/leaflet.js') }}"></script>
        <script src="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"></script>
        <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
        <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />

    </head>

    <body>
    {% include 'navbar.html' %}


    <div id ="page" class="container-fluid">
        <div class='row' id="presentationEspece">
                <div class="col-sm-2" > 
                    <img src="{{url_for('static', filename='/images/pne.jpg') }}" style="width:200px;height:200px;">
                </div>
                <div class="col-sm-3" > 
                    <h3> {{taxon.lb_nom}} </h3>
                    <p> <i> {{taxon.nom_vern}} </i> <br/>
                    Nombre d'observation sur le parc: <i> {{observations.features|length}} </i> </br>

                    <a href='https://inpn.mnhn.fr/espece/cd_nom/{{taxon.cd_nom}}' target="_blank">Fiche INPN</a>
                </div>
       </div>


        <div id="mapRow" class="row">
            <div id='mapContainer' class="row col-sm-12">
                <div id="map"> </div>
            </div>
        </div>

        <div id="mapOptions" class="row">

            <div class="col-sm-3" ><input id="slider" type="text" class="span2" size= "10"/> </div>
            <div class="col-sm-2" > <input type="checkbox" name="my-checkbox" id="checkbox" checked  data-on-text="Cluster"data-off-text="Point" data-size="mini"> </div>


        </div>

    </div>


    
    <script type="text/javascript" src="/atlas/static/conf/calculCustom.js"></script>

    <script type="text/javascript" src="/atlas/static/conf/custom.js"></script>

    <script src="{{url_for('static', filename='map.js') }}"></script>
    <script src="{{url_for('static', filename='main.js') }}"></script>



<!--  Lancement des fonction JS necessitant la syntaxe Jinja-->
    <script type="text/javascript">
    autocompleteTaxons({{ listeTaxons|tojson }})

    displayMarkers({{observations|tojson}})



mySwitcher = $("[name='my-checkbox']").bootstrapSwitch();


var yearMin = $YEARMIN;
var yearMax = $YEARMAX;


mySlider.on("slide",function(){
    years = mySlider.getValue();
    yearMin = years[0];
    yearMax = years[1];
    console.log(newMarkers);
    (newMarkers == undefined) ? map.removeLayer(clusterMarkers):map.removeLayer(newMarkers);

    if ( $("#checkbox").is(":checked")){
    displayFilterMarkers({{observations|tojson}}, yearMin, yearMax, true);
    } else {
    displayFilterMarkers({{observations|tojson}}, yearMin, yearMax, false);
    }
   });

mySwitcher.on('switchChange.bootstrapSwitch', function(state) {
  
currentMarker = (newMarkers == undefined) ? clusterMarkers:newMarkers;
map.removeLayer(currentMarker);


displayFilterMarkers({{observations|tojson}}, yearMin, yearMax, this.checked)

});





    </script>


    </body>
</html>